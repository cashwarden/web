(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{NZL8:function(t,e,i){"use strict";i.r(e),i.d(e,"SettingsModule",(function(){return rt}));var s=i("M0ag"),n=i("fXoL"),a=i("Ac7g"),c=i("PScX"),o=i("ok2U");let r=(()=>{class t{constructor(t,e,i,s){this.http=t,this.settings=e,this.titleSrv=i,this.msg=s,this.schema={properties:{name:{type:"string",title:"\u7528\u6237\u540d"},email:{type:"string",format:"email",title:"\u90ae\u7bb1"},base_currency_code:{type:"string",title:"\u57fa\u7840\u8d27\u5e01",enum:[{label:"CNY",value:"CNY"}],default:"CNY"}},required:["username","email","base_currency_code"]}}ngOnInit(){this.titleSrv.setTitle("\u57fa\u672c\u8bbe\u7f6e"),this.user=this.settings.user}submit(t){this.msg.success("\u6682\u672a\u5f00\u53d1")}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.r),n.Ob(a.m),n.Ob(a.n),n.Ob(c.e))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-base"]],decls:2,vars:2,consts:[["mode","edit",3,"schema","formData","formSubmit"],["sf",""]],template:function(t,e){1&t&&(n.Ub(0,"sf",0,1),n.bc("formSubmit",(function(t){return e.submit(t)})),n.Tb()),2&t&&n.mc("schema",e.schema)("formData",e.user)},directives:[o.b],encapsulation:2,changeDetection:0}),t})();var l=i("AytR"),b=i("FwiY"),d=i("dEAy"),m=i("Ff2k"),u=i("C2AL"),h=i("ofXK");function p(t,e){if(1&t){const t=n.Vb();n.Ub(0,"a",6),n.bc("click",(function(){return n.yc(t),n.ec().bindTelegram()})),n.Kc(1,"\u4fee\u6539"),n.Tb()}}function g(t,e){1&t&&n.Pb(0,"i",7)}function f(t,e){1&t&&(n.Ub(0,"div"),n.Kc(1,"\u5f53\u524d\u672a\u7ed1\u5b9a Telegram \u8d26\u53f7"),n.Tb())}function v(t,e){if(1&t&&(n.Ub(0,"div"),n.Kc(1," \u5f53\u524d\u7ed1\u5b9a\u7684 Telegram \u8d26\u53f7 "),n.Ub(2,"a",9),n.Kc(3),n.Tb(),n.Tb()),2&t){const t=n.ec(2);n.Ab(2),n.oc("href","https://t.me/",null==t.telegram?null:t.telegram.client_username,"",n.Ac),n.Ab(1),n.Mc("@",null==t.telegram?null:t.telegram.client_username,"")}}function y(t,e){if(1&t&&(n.Ic(0,f,2,0,"div",8),n.Ic(1,v,4,2,"div",8)),2&t){const t=n.ec();n.mc("ngIf",!t.telegram),n.Ab(1),n.mc("ngIf",t.telegram)}}const z=function(t){return[t]};let T=(()=>{class t{constructor(t,e,i,s,n,a,c){this.http=t,this.msg=e,this.iconService=i,this.modal=s,this.cdr=n,this.titleSrv=a,this.settings=c,this.telegram={client_username:""},this.iconService.fetchFromIconfont({scriptUrl:l.a.iconfontURl})}ngOnInit(){this.titleSrv.setTitle("\u8d26\u53f7\u7ed1\u5b9a"),this.getData()}getData(){this.http.get("/api/users/auth-clients").subscribe(t=>{var e;this.telegram=null===(e=t.data)||void 0===e?void 0:e.telegram,this.cdr.detectChanges()})}bindTelegram(){const t=this.settings.app.telegram_bot_name;this.http.post("/api/reset-token").subscribe(e=>{this.modal.info({nzWidth:"500px",nzTitle:"\u7ed1\u5b9a Telegram \u8d26\u53f7",nzContent:`\u5c06\u4e0b\u9762\u7684\u7ed1\u5b9a\u7801\u590d\u5236\u53d1\u9001\u7ed9 Telegram \u673a\u5668\u4eba <a href="https://t.me/${t}" target="_blank">@${t}</a> </br> <code>${"/bind/"+e.data.reset_token}</code>`,nzOnOk:()=>this.getData()})})}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.r),n.Ob(c.e),n.Ob(b.c),n.Ob(d.c),n.Ob(n.h),n.Ob(a.n),n.Ob(a.m))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-binding"]],decls:9,vars:5,consts:[["nzItemLayout","horizontal"],[3,"nzActions"],["telegramOp",""],["nzTitle","\u7ed1\u5b9a Telegram",3,"nzAvatar","nzDescription"],["telegramAvatar",""],["telegramDescription",""],[3,"click"],["nz-icon","","nzIconfont","icon-telegram",1,"icon-sm"],[4,"ngIf"],["target","_blank",3,"href"]],template:function(t,e){if(1&t&&(n.Ub(0,"nz-list",0),n.Ub(1,"nz-list-item",1),n.Ic(2,p,2,0,"ng-template",null,2,n.Jc),n.Ub(4,"nz-list-item-meta",3),n.Ic(5,g,1,0,"ng-template",null,4,n.Jc),n.Ic(7,y,2,2,"ng-template",null,5,n.Jc),n.Tb(),n.Tb(),n.Tb()),2&t){const t=n.vc(3),e=n.vc(6),i=n.vc(8);n.Ab(1),n.mc("nzActions",n.qc(3,z,t)),n.Ab(3),n.mc("nzAvatar",e)("nzDescription",i)}},directives:[m.a,m.c,m.d,u.a,b.a,h.n],encapsulation:2,changeDetection:0}),t})();var _=i("tyNb"),O=i("xgIS"),U=i("pLZG"),w=i("Kj3r"),x=i("Q8cG");function k(t,e){if(1&t){const t=n.Vb();n.Ub(0,"li",6),n.bc("click",(function(){n.yc(t);const i=e.$implicit;return n.ec().to(i)})),n.Kc(1),n.Tb()}if(2&t){const t=e.$implicit;n.mc("nzSelected",t.selected),n.Ab(1),n.Lc(t.title)}}let S=(()=>{class t{constructor(t,e,i){this.router=t,this.cdr=e,this.el=i,this.mode="inline",this.menus=[{key:"base",title:"\u57fa\u672c\u8bbe\u7f6e"},{key:"binding",title:"\u8d26\u53f7\u7ed1\u5b9a"}],this.router$=this.router.events.pipe(Object(U.a)(t=>t instanceof _.b)).subscribe(()=>this.setActive())}setActive(){const t=this.router.url.substr(this.router.url.lastIndexOf("/")+1);this.menus.forEach(e=>{e.selected=e.key===t}),this.title=this.menus.find(t=>t.selected).title}to(t){this.router.navigateByUrl("/settings/personal/"+t.key)}resize(){const t=this.el.nativeElement;let e="inline";const{offsetWidth:i}=t;i<641&&i>400&&(e="horizontal"),window.innerWidth<768&&i>400&&(e="horizontal"),this.mode=e,this.cdr.detectChanges()}ngAfterViewInit(){this.resize$=Object(O.a)(window,"resize").pipe(Object(w.a)(200)).subscribe(()=>this.resize())}ngOnDestroy(){this.resize$.unsubscribe(),this.router$.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(_.k),n.Ob(n.h),n.Ob(n.l))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-personal"]],decls:8,vars:3,consts:[[1,"main","ant-card-bordered"],[1,"menu"],["nz-menu","",3,"nzMode"],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[1,"content"],[1,"title"],["nz-menu-item","",3,"nzSelected","click"]],template:function(t,e){1&t&&(n.Ub(0,"div",0),n.Ub(1,"div",1),n.Ub(2,"ul",2),n.Ic(3,k,2,2,"li",3),n.Tb(),n.Tb(),n.Ub(4,"div",4),n.Ub(5,"div",5),n.Kc(6),n.Tb(),n.Pb(7,"router-outlet"),n.Tb(),n.Tb()),2&t&&(n.Ab(2),n.mc("nzMode",e.mode),n.Ab(1),n.mc("ngForOf",e.menus),n.Ab(3),n.Lc(e.title))},directives:[x.c,h.m,_.o,u.a,x.e],styles:["[_nghost-%COMP%]{display:block;padding-top:24px}[_nghost-%COMP%]     .main{display:flex;width:100%;padding-top:16px;padding-bottom:16px;overflow:auto;background-color:#fff}[_nghost-%COMP%]     .menu{width:224px;border-right:1px solid #f0f0f0}[_nghost-%COMP%]     .menu .ant-menu-inline{border:none}[_nghost-%COMP%]     .menu .ant-menu:not(.ant-menu-horizontal) .ant-menu-item-selected{font-weight:700}[_nghost-%COMP%]     .content{flex:1;padding:8px 40px}[_nghost-%COMP%]     .content .title{margin-bottom:12px;color:rgba(0,0,0,.85);font-weight:500;font-size:20px;line-height:28px}[_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom:1px solid #e8e8e8}[_nghost-%COMP%]     .content .ant-list-item{padding-top:14px;padding-bottom:14px}@media screen and (max-width:767px){[_nghost-%COMP%]     .main{flex-direction:column}[_nghost-%COMP%]     .main .menu{width:100%;border:none}[_nghost-%COMP%]     .main .content{padding:40px}}[data-theme=dark]   [_nghost-%COMP%]     .main{background-color:#141414}[data-theme=dark]   [_nghost-%COMP%]     .content .title{color:hsla(0,0%,100%,.65)}[data-theme=dark]   [_nghost-%COMP%]     .menu{border-right-color:#303030}[data-theme=dark]   [_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom-color:#303030}"],changeDetection:0}),t})();var A=i("LRne"),D=i("3E0/"),I=i("vkgz"),M=i("lJxs"),C=i("OzZK"),P=i("RwU8");const K=["sf"];let R=(()=>{class t{constructor(t,e,i){this.modal=t,this.msgSrv=e,this.http=i,this.record={},this.selectRawData={},this.schema={properties:{name:{type:"string",title:"\u540d\u79f0"},if_keywords:{type:"string",title:"\u5173\u952e\u8bcd",default:null,ui:{widget:"select",mode:"tags"}},then_transaction_type:{type:"string",title:"\u5206\u914d\u4ea4\u6613\u7c7b\u578b",ui:{widget:"radio",styleType:"button",buttonStyle:"solid",asyncData:()=>Object(A.a)([{value:"expense",label:"\u652f\u51fa"},{value:"income",label:"\u6536\u5165"},{value:"transfer",label:"\u8f6c\u8d26"}]).pipe(Object(D.a)(100),Object(I.a)(()=>this.updateCategories(this.record.then_transaction_type||"expense",this.record.then_category_id))),change:t=>this.updateCategories(t,null)},default:"expense"},then_from_account_id:{type:"string",title:"\u5206\u914d\u652f\u4ed8\u5e10\u6237",ui:{widget:"select",visibleIf:{then_transaction_type:["expense","transfer"]},asyncData:()=>Object(A.a)(this.selectRawData.account_id).pipe(Object(D.a)(200))}},then_to_account_id:{type:"string",title:"\u5206\u914d\u6536\u6b3e\u5e10\u6237",ui:{widget:"select",visibleIf:{then_transaction_type:["income","transfer"]},asyncData:()=>Object(A.a)(this.selectRawData.account_id).pipe(Object(D.a)(200))}},then_category_id:{type:"string",title:"\u5206\u914d\u7c7b\u522b",ui:{widget:"select"}},then_tags:{type:"string",title:"\u5206\u914d\u6807\u7b7e",default:null,ui:{widget:"select",mode:"tags",asyncData:()=>Object(A.a)(this.selectRawData.tags).pipe(Object(D.a)(200))}},sort:{type:"number",title:"\u6392\u5e8f",minimum:0,maximum:99,default:99}},required:["name","if_keywords"]},this.ui={"*":{spanLabelFixed:100,grid:{span:24}}}}save(t){this.http.request(this.record.id?"put":"post","/api/rules"+(this.record.id?"/"+this.record.id:""),{body:t}).subscribe(t=>{0===t.code?(this.msgSrv.success("\u4fdd\u5b58\u6210\u529f"),this.modal.close(t.data)):this.msgSrv.warning(t.message)})}loadItems(t,e){return this.http.get(t).pipe(Object(M.a)(t=>{if(0===t.code)return t.data.items.map(t=>"then_tags"===e?{value:t.name,label:t.name}:{value:t.id,label:t.name});this.msgSrv.warning(t.message)}))}updateCategories(t,e){const i=this.sf.getProperty("/then_category_id"),s=this.selectRawData.category_id.filter(e=>e.transaction_type===t);i.schema.enum=s,i.widget.reset(e||s[0])}close(){this.modal.destroy()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(d.b),n.Ob(c.e),n.Ob(a.r))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-rules-form"]],viewQuery:function(t,e){var i;1&t&&n.Pc(K,!0),2&t&&n.uc(i=n.cc())&&(e.sf=i.first)},decls:10,vars:6,consts:[[1,"modal-header"],[1,"modal-title"],["mode","edit","button","none",3,"schema","ui","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",0),n.Ub(1,"div",1),n.Kc(2),n.Tb(),n.Tb(),n.Ub(3,"sf",2,3),n.Ub(5,"div",4),n.Ub(6,"button",5),n.bc("click",(function(){return e.close()})),n.Kc(7,"\u5173\u95ed"),n.Tb(),n.Ub(8,"button",6),n.bc("click",(function(){n.yc(t);const i=n.vc(4);return e.save(i.value)})),n.Kc(9," \u4fdd\u5b58 "),n.Tb(),n.Tb(),n.Tb()}if(2&t){const t=n.vc(4);n.Ab(2),n.Mc("\u7f16\u8f91 ",e.record.id," \u4fe1\u606f"),n.Ab(1),n.mc("schema",e.schema)("ui",e.ui)("formData",e.record),n.Ab(5),n.mc("disabled",!t.valid)("nzLoading",e.http.loading)}},directives:[o.b,C.a,P.a,u.a],encapsulation:2}),t})();var q=i("JA5x"),j=i("B+r4"),L=i("DGaY");const $=["st"],F=function(){return{xs:6,sm:16,md:24,lg:32}};let V=(()=>{class t{constructor(t,e,i){this.http=t,this.modal=e,this.message=i,this.loading=!0,this.list=[],this.selectRawData={},this.q={page:1,pageSize:100,name:""},this.searchSchema={properties:{name:{type:"string",title:"\u540d\u79f0"}}},this.columns=[{title:"\u540d\u79f0 ",index:"name"},{title:"\u5173\u952e\u8bcd",index:"if_keywords"},{title:"\u5206\u914d\u4ea4\u6613\u7c7b\u578b",index:"then_transaction_type_text"},{title:"\u5206\u914d\u7c7b\u522b",index:"thenCategory.name"},{title:"\u6392\u5e8f",index:"sort"},{title:"\u72b6\u6001",type:"badge",index:"status",badge:{active:{text:"active",color:"success"},unactivated:{text:"unactivated",color:"default"}}},{title:"\u65f6\u95f4",type:"date",index:"updated_at"},{title:"",buttons:[{text:"\u7f16\u8f91",click:t=>this.form(t)},{text:"\u590d\u5236",click:t=>this.copy(t)},{text:t=>"active"===t.status?"\u505c\u7528":"\u542f\u7528",click:t=>{this.updateStatus(t,"active"===t.status?"unactivated":"active")}},{text:"\u5220\u9664",pop:{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",okType:"danger"},click:(t,e,i)=>{this.delete(t),i.removeRow(t)}}]}]}ngOnInit(){this.getData(),this.loadSelect("/api/accounts","account_id"),this.loadSelect("/api/categories","category_id"),this.loadSelect("/api/tags","tags")}getData(){this.loading=!0,this.http.get("/api/rules",this.q).subscribe(t=>{this.list=t.data.items,this.pagination=t.data._meta,this.loading=!1})}form(t={}){this.modal.create(R,{record:t,selectRawData:this.selectRawData},{size:"md"}).subscribe(t=>{this.getData()})}copy(t){this.http.post(`/api/rules/${t.id}/copy`).subscribe(t=>{0===(null==t?void 0:t.code)?(this.list.splice(0,0,t.data),this.list=[...this.list],this.message.success("\u590d\u5236\u6210\u529f")):this.message.warning(null==t?void 0:t.message)})}delete(t){this.http.delete("/api/rules/"+t.id).subscribe(t=>{0===(null==t?void 0:t.code)?this.message.success("\u5220\u9664\u6210\u529f"):this.message.warning(null==t?void 0:t.message)})}updateStatus(t,e){this.http.put(`/api/rules/${t.id}/status`,{status:e}).subscribe(t=>{0===(null==t?void 0:t.code)?(this.getData(),this.message.success("\u66f4\u65b0\u6210\u529f")):this.message.warning(null==t?void 0:t.message)})}loadSelect(t,e){this.http.get(t,{pageSize:50}).subscribe(t=>{t.data&&(this.selectRawData[e]="tags"===e?t.data.items.map(t=>({value:t.name,label:t.name})):"transaction_type"===e?t.data.map(t=>({value:t.type,label:t.name})):t.data.items.map("category_id"===e?t=>({value:t.id,label:t.name,transaction_type:t.transaction_type}):t=>({value:t.id,label:t.name})))})}submit(t){t.name&&(this.q.name=t.name,this.getData())}reset(){this.q.name="",this.getData()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.r),n.Ob(a.j),n.Ob(c.e))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-rules"]],viewQuery:function(t,e){var i;1&t&&n.Pc($,!0),2&t&&n.uc(i=n.cc())&&(e.st=i.first)},decls:11,vars:5,consts:[[1,"pt-lg"],["nz-row","",3,"nzGutter"],["nz-col",""],["mode","search",3,"schema","formSubmit","formReset"],["nz-button","","nzType","primary",3,"click"],[3,"data","columns"],["st",""]],template:function(t,e){1&t&&(n.Ub(0,"div",0),n.Ub(1,"nz-card"),n.Ub(2,"div",1),n.Ub(3,"div",2),n.Ub(4,"sf",3),n.bc("formSubmit",(function(t){return e.submit(t)}))("formReset",(function(){return e.reset()})),n.Tb(),n.Tb(),n.Ub(5,"div",2),n.Ub(6,"button",4),n.bc("click",(function(){return e.form()})),n.Kc(7,"\u65b0\u5efa"),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Ub(8,"nz-card"),n.Pb(9,"st",5,6),n.Tb()),2&t&&(n.Ab(2),n.mc("nzGutter",n.pc(4,F)),n.Ab(2),n.mc("schema",e.searchSchema),n.Ab(5),n.mc("data",e.list)("columns",e.columns))},directives:[q.a,j.c,j.a,o.b,C.a,P.a,u.a,L.a],encapsulation:2}),t})(),G=(()=>{class t{constructor(t,e,i){this.http=t,this.settings=e,this.titleSrv=i,this.schema={properties:{name:{type:"string",title:"\u7528\u6237\u540d"},email:{type:"string",format:"email",title:"\u90ae\u7bb1"},base_currency_code:{type:"string",title:"\u57fa\u7840\u8d27\u5e01",enum:[{label:"CNY",value:"CNY"}],default:"CNY"}},required:["username","email","base_currency_code"]}}ngOnInit(){this.titleSrv.setTitle("\u5b89\u5168\u8bbe\u7f6e"),this.user=this.settings.user}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.r),n.Ob(a.m),n.Ob(a.n))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-security"]],decls:2,vars:2,consts:[["mode","edit",3,"schema","formData"],["sf",""]],template:function(t,e){1&t&&n.Pb(0,"sf",0,1),2&t&&n.mc("schema",e.schema)("formData",e.user)},directives:[o.b],encapsulation:2}),t})();const N=["sf"];let Y=(()=>{class t{constructor(t,e,i){this.modal=t,this.msgSrv=e,this.http=i,this.record={},this.schema={properties:{name:{type:"string",title:"\u540d\u79f0"}},required:["name"]},this.ui={"*":{spanLabelFixed:100,grid:{span:24}}}}ngOnInit(){}save(t){this.http.request(this.record.id?"put":"post","/api/tags"+(this.record.id?"/"+this.record.id:""),{body:t}).subscribe(t=>{0===t.code?(this.msgSrv.success("\u4fdd\u5b58\u6210\u529f"),this.modal.close(t.data)):this.msgSrv.warning(t.message)})}close(){this.modal.destroy()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(d.b),n.Ob(c.e),n.Ob(a.r))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-tags-edit"]],viewQuery:function(t,e){var i;1&t&&n.Pc(N,!0),2&t&&n.uc(i=n.cc())&&(e.sf=i.first)},decls:10,vars:6,consts:[[1,"modal-header"],[1,"modal-title"],["mode","edit","button","none",3,"schema","ui","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",0),n.Ub(1,"div",1),n.Kc(2),n.Tb(),n.Tb(),n.Ub(3,"sf",2,3),n.Ub(5,"div",4),n.Ub(6,"button",5),n.bc("click",(function(){return e.close()})),n.Kc(7,"\u5173\u95ed"),n.Tb(),n.Ub(8,"button",6),n.bc("click",(function(){n.yc(t);const i=n.vc(4);return e.save(i.value)})),n.Kc(9," \u4fdd\u5b58 "),n.Tb(),n.Tb(),n.Tb()}if(2&t){const t=n.vc(4);n.Ab(2),n.Mc("\u7f16\u8f91 ",e.record.id," \u4fe1\u606f"),n.Ab(1),n.mc("schema",e.schema)("ui",e.ui)("formData",e.record),n.Ab(5),n.mc("disabled",!t.valid)("nzLoading",e.http.loading)}},directives:[o.b,C.a,P.a,u.a],encapsulation:2}),t})();const J=["st"],Q=function(){return{xs:6,sm:16,md:24,lg:32}};let E=(()=>{class t{constructor(t,e,i,s){this.http=t,this.modal=e,this.cdr=i,this.msg=s,this.loading=!0,this.list=[],this.q={page:1,pageSize:100,name:""},this.searchSchema={properties:{name:{type:"string",title:"\u540d\u79f0"}}},this.columns=[{title:"\u540d\u79f0",index:"name"},{title:"\u6b21\u6570",index:"count"},{title:"\u65f6\u95f4",type:"date",index:"updated_at"},{title:"",buttons:[{text:"\u7f16\u8f91",click:t=>this.form(t)},{text:"\u5220\u9664",pop:{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",okType:"danger"},click:(t,e,i)=>{this.delete(t,i)}}]}]}ngOnInit(){this.getData()}getData(){this.loading=!0,this.http.get("/api/tags",this.q).subscribe(t=>{this.list=t.data.items,this.pagination=t.data._meta,this.loading=!1})}form(t={}){this.modal.create(Y,{record:t},{size:"md"}).subscribe(e=>{t.id?this.getData():(this.list.splice(0,0,e),this.list=[...this.list])})}delete(t,e){this.http.delete("/api/tags/"+t.id).subscribe(i=>{0===(null==i?void 0:i.code)?(e.removeRow(t),this.msg.success("\u5220\u9664\u6210\u529f")):this.msg.warning(null==i?void 0:i.message)})}submit(t){t.name&&(this.q.name=t.name,this.getData())}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.r),n.Ob(a.j),n.Ob(n.h),n.Ob(c.e))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-tags"]],viewQuery:function(t,e){var i;1&t&&n.Pc(J,!0),2&t&&n.uc(i=n.cc())&&(e.st=i.first)},decls:11,vars:5,consts:[[1,"pt-lg"],["nz-row","",3,"nzGutter"],["nz-col",""],["mode","search",3,"schema","formSubmit","formReset"],["nz-button","","nzType","primary",3,"click"],[3,"data","columns"],["st",""]],template:function(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",0),n.Ub(1,"nz-card"),n.Ub(2,"div",1),n.Ub(3,"div",2),n.Ub(4,"sf",3),n.bc("formSubmit",(function(t){return e.submit(t)}))("formReset",(function(e){return n.yc(t),n.vc(10).reset(e)})),n.Tb(),n.Tb(),n.Ub(5,"div",2),n.Ub(6,"button",4),n.bc("click",(function(){return e.form()})),n.Kc(7,"\u65b0\u5efa"),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Ub(8,"nz-card"),n.Pb(9,"st",5,6),n.Tb()}2&t&&(n.Ab(2),n.mc("nzGutter",n.pc(4,Q)),n.Ab(2),n.mc("schema",e.searchSchema),n.Ab(5),n.mc("data",e.list)("columns",e.columns))},directives:[q.a,j.c,j.a,o.b,C.a,P.a,u.a,L.a],encapsulation:2}),t})();var B=i("3Pt+"),W=i("ocnv"),Z=i("O3k0"),X=i("PTRe"),H=i("bE2y");function tt(t,e){if(1&t&&(n.Ub(0,"label",18),n.Pb(1,"i",19),n.Tb()),2&t){const t=e.$implicit;n.mc("nzValue",t),n.Ab(1),n.oc("nzIconfont","icon-",t,"")}}let et=(()=>{class t{constructor(t,e,i,s){this.modal=t,this.msgSrv=e,this.http=i,this.cdr=s,this.record={},this.form={name:"",transaction_type:"expense",sort:99,icon_name:""}}ngOnInit(){this.loadIcons(),this.record.id&&(this.form=this.record)}save(t){this.http.request(this.record.id?"put":"post","/api/categories"+(this.record.id?"/"+this.record.id:""),{body:t}).subscribe(t=>{0===t.code?(this.msgSrv.success("\u4fdd\u5b58\u6210\u529f"),this.modal.close(t.data)):this.msgSrv.warning(t.message)})}loadIcons(){this.http.get("/api/icons").subscribe(t=>{0===t.code?(this.icons=t.data,this.cdr.detectChanges()):this.msgSrv.warning(t.message)})}close(){this.modal.destroy()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(d.b),n.Ob(c.e),n.Ob(a.r),n.Ob(n.h))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-categories-edit"]],decls:25,vars:7,consts:[[1,"modal-header"],[1,"modal-title"],["nz-form","","se-container","1","labelWidth","100",3,"ngSubmit"],["f","ngForm"],["label","\u540d\u79f0"],["type","text","nz-input","","name","name","required","","maxlength","32",3,"ngModel","ngModelChange"],["label","\u4ea4\u6613\u7c7b\u578b"],["nzButtonStyle","solid","name","type",3,"ngModel","ngModelChange"],["nz-radio-button","","nzValue","expense"],["nz-radio-button","","nzValue","income"],["label","\u56fe\u6807"],["name","icon_name","required","",3,"ngModel","ngModelChange"],["nz-radio","",3,"nzValue",4,"ngFor","ngForOf"],["label","\u6392\u5e8f"],["type","number","nz-input","","name","sort","required","",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","nzType","primary",3,"disabled"],["nz-button","","type","button",3,"click"],["nz-radio","",3,"nzValue"],["nz-icon","",1,"icon-md",3,"nzIconfont"]],template:function(t,e){if(1&t&&(n.Ub(0,"div",0),n.Ub(1,"div",1),n.Kc(2),n.Tb(),n.Tb(),n.Ub(3,"form",2,3),n.bc("ngSubmit",(function(){return e.save(e.form)})),n.Ub(5,"se",4),n.Ub(6,"input",5),n.bc("ngModelChange",(function(t){return e.form.name=t})),n.Tb(),n.Tb(),n.Ub(7,"se",6),n.Ub(8,"nz-radio-group",7),n.bc("ngModelChange",(function(t){return e.form.transaction_type=t})),n.Ub(9,"label",8),n.Ub(10,"span"),n.Kc(11,"\u652f\u51fa"),n.Tb(),n.Tb(),n.Ub(12,"label",9),n.Ub(13,"span"),n.Kc(14,"\u6536\u5165"),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Ub(15,"se",10),n.Ub(16,"nz-radio-group",11),n.bc("ngModelChange",(function(t){return e.form.icon_name=t})),n.Ic(17,tt,2,2,"label",12),n.Tb(),n.Tb(),n.Ub(18,"se",13),n.Ub(19,"input",14),n.bc("ngModelChange",(function(t){return e.form.sort=t})),n.Tb(),n.Tb(),n.Ub(20,"se",15),n.Ub(21,"button",16),n.Kc(22,"\u4fdd\u5b58"),n.Tb(),n.Ub(23,"button",17),n.bc("click",(function(){return e.close()})),n.Kc(24,"\u5173\u95ed"),n.Tb(),n.Tb(),n.Tb()),2&t){const t=n.vc(4);n.Ab(2),n.Mc("\u7f16\u8f91 ",e.record.id," \u4fe1\u606f"),n.Ab(4),n.mc("ngModel",e.form.name),n.Ab(2),n.mc("ngModel",e.form.transaction_type),n.Ab(8),n.mc("ngModel",e.form.icon_name),n.Ab(1),n.mc("ngForOf",e.icons),n.Ab(2),n.mc("ngModel",e.form.sort),n.Ab(2),n.mc("disabled",t.invalid)}},directives:[B.t,B.m,B.n,W.b,Z.b,Z.a,X.b,B.c,B.r,B.i,B.l,B.o,H.c,H.b,H.a,h.m,B.p,C.a,P.a,u.a,b.a],encapsulation:2}),t})();const it=["st"];function st(t,e){1&t&&n.Kc(0),2&t&&n.Mc(" ",e.$implicit.title.text," ")}function nt(t,e){if(1&t&&(n.Pb(0,"i",9),n.Kc(1)),2&t){const t=e.$implicit;n.oc("nzIconfont","icon-",t.icon_name,""),n.Ab(1),n.Mc(" ",t.name," ")}}const at=function(){return{xs:6,sm:16,md:24,lg:32}},ct=[{path:"rules",component:V},{path:"personal",component:S,children:[{path:"",redirectTo:"base",pathMatch:"full"},{path:"base",component:r},{path:"binding",component:T},{path:"security",component:G}]},{path:"tags",component:E},{path:"categories",component:(()=>{class t{constructor(t,e,i,s){this.http=t,this.modal=e,this.cdr=i,this.msg=s,this.loading=!0,this.list=[],this.q={page:1,pageSize:100,name:"",transaction_type:""},this.transactionTypes=[],this.searchSchema={properties:{name:{type:"string",title:"\u540d\u79f0"},transaction_type:{type:"string",title:"\u4ea4\u6613\u7c7b\u578b",default:"",ui:{widget:"select",asyncData:()=>this.http.get("/api/transactions/types").pipe(Object(M.a)(t=>{if(0===t.code)return t.data.map(t=>({value:t.type,label:t.name}));this.msg.warning(t.message)}))}}}},this.columns=[{title:"\u540d\u79f0",renderTitle:"customTitle",render:"custom"},{title:"\u4ea4\u6613\u7c7b\u578b",index:"transaction_type_text"},{title:"\u6392\u5e8f",index:"sort"},{title:"\u65f6\u95f4",type:"date",index:"updated_at"},{title:"",buttons:[{text:"\u7f16\u8f91",click:t=>this.form(t),iif:t=>!["adjust","transfer"].includes(t.transaction_type),iifBehavior:"disabled"}]}]}ngOnInit(){this.getData()}getData(){this.loading=!0,this.http.get("/api/categories",this.q).subscribe(t=>{this.list=t.data.items,this.pagination=t.data._meta,this.loading=!1})}form(t={}){this.modal.create(et,{record:t},{size:"md"}).subscribe(e=>{t.id?this.getData():(this.list.splice(0,0,e),this.list=[...this.list])})}submit(t){this.q=t,this.getData()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.r),n.Ob(a.j),n.Ob(n.h),n.Ob(c.e))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-settings-categories"]],viewQuery:function(t,e){var i;1&t&&n.Pc(it,!0),2&t&&n.uc(i=n.cc())&&(e.st=i.first)},decls:13,vars:5,consts:[[1,"pt-lg"],["nz-row","",3,"nzGutter"],["nz-col",""],["mode","search",3,"schema","formSubmit","formReset"],["nz-button","","nzType","primary",3,"click"],[3,"data","columns"],["st",""],["st-row","customTitle","type","title"],["st-row","custom"],["nz-icon","",1,"icon-sm",3,"nzIconfont"]],template:function(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",0),n.Ub(1,"nz-card"),n.Ub(2,"div",1),n.Ub(3,"div",2),n.Ub(4,"sf",3),n.bc("formSubmit",(function(t){return e.submit(t)}))("formReset",(function(e){return n.yc(t),n.vc(10).reset(e)})),n.Tb(),n.Tb(),n.Ub(5,"div",2),n.Ub(6,"button",4),n.bc("click",(function(){return e.form()})),n.Kc(7,"\u65b0\u5efa"),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Ub(8,"nz-card"),n.Ub(9,"st",5,6),n.Ic(11,st,1,1,"ng-template",7),n.Ic(12,nt,2,2,"ng-template",8),n.Tb(),n.Tb()}2&t&&(n.Ab(2),n.mc("nzGutter",n.pc(4,at)),n.Ab(2),n.mc("schema",e.searchSchema),n.Ab(5),n.mc("data",e.list)("columns",e.columns))},directives:[q.a,j.c,j.a,o.b,C.a,P.a,u.a,L.a,L.c,b.a],encapsulation:2}),t})()}];let ot=(()=>{class t{}return t.\u0275mod=n.Mb({type:t}),t.\u0275inj=n.Lb({factory:function(e){return new(e||t)},imports:[[_.n.forChild(ct)],_.n]}),t})();i("qAZ0"),i("0lRi");let rt=(()=>{class t{}return t.\u0275mod=n.Mb({type:t}),t.\u0275inj=n.Lb({factory:function(e){return new(e||t)},imports:[[s.b,ot]]}),t})()}}]);